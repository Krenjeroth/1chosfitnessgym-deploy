import{b as pe,c as Z,z as f,e as ee,_ as Q,l as ue,i as be,u as _e,a as he}from"./upptak3D.js";import{m as Me}from"./50pTwbTH.js";import{p as te,F as fe,y as A,h as G,C as j,j as W,o as I,w as s,e as n,A as ae,a as e,d as l,t as w,f as k,B as X,b as ge,D as Se,E as z,c as ve}from"./CmAaC7-r.js";import{u as ye}from"./B_gzkPqb.js";import{a as oe,b as re}from"./CxBsuVx0.js";import{u as se,_ as ne,f as De,a as ie}from"./CRJ-krNX.js";import{u as le}from"./ta7sgxvC.js";import"./moRlnmHh.js";const we=()=>{const q=ye(),p=te(()=>new URL("http://1chosfitnessgym/api/memberships"));return{getMembershipsApi:async a=>await q(`${p.value}?${a.toString()}`),addMembershipApi:async a=>await q(`${p.value}`,{method:"POST",body:a}),updateMembershipApi:async(a,g)=>await q(`${p.value}/${a}`,{method:"PUT",body:g}),deleteMembershipApi:async a=>await q(`${p.value}/${a}`,{method:"DELETE",headers:{Accept:"application/json"}})}},J=fe("membershipStore",()=>{const{getMembershipsApi:q,addMembershipApi:p,updateMembershipApi:u,deleteMembershipApi:b}=we(),{hasError:x,errorBag:v,transformValidationErrors:a,resetErrorBag:g}=pe(),{transformUtcDatetime:U,transformDatePickerDate:E,transformDateDurationHumanize:Y,calculateExpiryDate:y,checkTodayIsAfterExpiryDate:t}=Z();let C;(c=>{c.ASC="asc",c.DESC="desc"})(C||(C={}));const _=A([]),h=A(!1),V=A(1),d=A(5),r=A(""),i=A({column:"created_at",direction:"desc"}),T=A(0),S=A("");return{memberships:_,loading:h,errorBag:v,hasError:x,page:V,pageCount:d,search:r,sort:i,totalMemberships:T,selectedStatus:S,getMemberships:async()=>{h.value=!0;try{const c=new URLSearchParams({page:V.value.toString(),per_page:d.value.toString(),sort:i.value.column,order:i.value.direction,search:r.value,...S.value?{status:S.value}:{}}),D=await q(c);_.value=D.data.map(o=>({id:o.id,member_id:o.member.id,member_name:o.member.full_name,plan:o.plan,plan_id:o.plan.id,plan_column:`${o.plan.name} (${o.plan.validity>1?o.plan.validity+" mos.":o.plan.validity+" mo."} / ₱${o.plan.price})`,status:o.status,status_word:o.status?"Active":"Expired",start_date:E(o.start_date,"MMM DD, YYYY"),expiry_date:E(o.expiry_date,"MMM DD, YYYY"),start_expiry:`Start Date: ${U(o.start_date,"MMM DD, YYYY")}\r
Expiry Date: ${U(o.expiry_date,"MMM DD, YYYY")}\r
${o.status?"Expires":"Expired"} ${Y(o.expiry_date)}`})),T.value=Number(D.meta.total)||0}catch(c){throw c}finally{h.value=!1}},addMembership:async c=>{var B,N;h.value=!0,g();const D=E(c.start_date,"YYYY-MM-DD HH:mm:ss"),o=(B=c.plan)==null?void 0:B.validity,P=y(D,o),m={member_id:c.member,plan_id:(N=c.plan)==null?void 0:N.id,status:1,start_date:D,expiry_date:P};await p(m).catch(F=>{a(F)}).finally(()=>{h.value=!1})},updateMembership:async(c,D)=>{var F,L;h.value=!0,g();const o=E(D.start_date,"YYYY-MM-DD HH:mm:ss"),P=(F=D.plan)==null?void 0:F.validity,m=y(o,P),B=t(m)?0:1,N={member_id:D.member,plan_id:(L=D.plan)==null?void 0:L.id,status:B,start_date:o,expiry_date:m};await u(c,N).catch(K=>{a(K)}).finally(()=>{h.value=!1})},deleteMembership:async c=>{h.value=!0,g(),await b(c).catch(D=>{a(D)}).finally(()=>{h.value=!1})}}}),xe=f.object({member:f.string({required_error:"Member is required"}),plan:f.object({id:f.number({required_error:"Plan is required"}),name:f.string({required_error:"Plan is required"}),description:f.string().optional(),validity:f.number({required_error:"Plan is required"}),price:f.string({required_error:"Plan is required"})}),start_date:f.date({required_error:"Start Date is required"})}),Ue={class:"truncate"},Ce={class:"truncate"},Ve={class:"italic"},$e={class:"font-semibold"},qe=G({__name:"CreateModal",emits:["reloadTable","success","error","close"],setup(q,{emit:p}){const u=J(),{loading:b,errorBag:x,hasError:v}=j(u),a=le(),{planSelect:g}=j(a),U=se(),{memberNoMembershipSelect:E}=j(U);U.getMemberNoMembershipSelect(),a.getPlanSelect();const Y=p,y=()=>Y("close"),t=()=>{Y("success"),Y("reloadTable"),y()},C=()=>{Y("error")},_=A({member:void 0,plan:void 0,start_date:void 0}),h=async V=>{if(await u.addMembership(V.data),v.value){C();return}t()};return(V,d)=>{const r=ee,i=re,T=X,S=ie,O=ne,H=oe,R=Q;return I(),W(R,{"on-close":y,title:"Create Membership"},{default:s(()=>[n(H,{schema:"CreateMembershipValidationSchema"in V?V.CreateMembershipValidationSchema:e(xe),state:e(_),onSubmit:ae(h,["prevent"]),class:"space-y-6"},{default:s(()=>[n(i,{label:"Member (No Active Membership)",name:"member",error:e(x).member,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(r,{searchable:"","searchable-placeholder":"Search member...",modelValue:e(_).member,"onUpdate:modelValue":d[0]||(d[0]=M=>e(_).member=M),options:e(E),"value-attribute":"id","option-attribute":"full_name",placeholder:"Select"},{option:s(({option:M})=>[l("span",Ue,w(M.full_name),1)]),_:1},8,["modelValue","options"])]),_:1},8,["error"]),n(i,{label:"Plan (Validity / Price)",name:"plan",error:e(x).plan,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(r,{searchable:"","searchable-placeholder":"Search plan...",modelValue:e(_).plan,"onUpdate:modelValue":d[1]||(d[1]=M=>e(_).plan=M),options:e(g),"option-attribute":"name",placeholder:"Select"},{option:s(({option:M})=>[l("span",Ce,[k(w(M.name)+" ",1),l("span",Ve,[d[3]||(d[3]=k("(")),l("span",$e,w(M.validity>1?M.validity+" mos.":M.validity+" mo.")+" / ₱"+w(M.price),1),k(") - "+w(M.description),1)])])]),_:1},8,["modelValue","options"])]),_:1},8,["error"]),n(i,{label:"Start Date",name:"start_date",error:e(x).start_date,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(O,{popper:{placement:"bottom-start"}},{panel:s(({close:M})=>[n(S,{modelValue:e(_).start_date,"onUpdate:modelValue":d[2]||(d[2]=c=>e(_).start_date=c),"is-required":"",mode:"date",onClose:M},null,8,["modelValue","onClose"])]),default:s(()=>[n(T,{icon:"i-heroicons-calendar-days-20-solid",label:e(_).start_date?e(De)(e(_).start_date,"yyyy/MM/dd"):"Select Date",ui:{base:"w-full md:w-full"},variant:"outline",color:"gray"},null,8,["label"])]),_:1})]),_:1},8,["error"]),n(T,{type:"submit",loading:e(b)},{default:s(()=>d[4]||(d[4]=[k(" Add ")])),_:1},8,["loading"])]),_:1},8,["schema","state"])]),_:1})}}}),Ee=f.object({member:f.string({required_error:"Member is required"}),plan:f.object({id:f.number({required_error:"Plan is required"}),name:f.string({required_error:"Plan is required"}),description:f.string().optional(),validity:f.number({required_error:"Plan is required"}),price:f.string({required_error:"Plan is required"})}),start_date:f.date({required_error:"Start Date is required"})}),Ye={class:"truncate"},Pe={class:"truncate"},Ae={class:"italic"},Te={class:"font-semibold"},Be=G({__name:"UpdateModal",props:{membership:Object},emits:["reloadTable","success","error","noDataChange","close"],setup(q,{emit:p}){var H,R,M,c,D,o;const u=J(),{loading:b,errorBag:x,hasError:v}=j(u),a=le(),{planSelect:g}=j(a),U=se(),{memberSelect:E}=j(U);U.getMemberSelect(),a.getPlanSelect();const{transformDatePickerDate:Y,transformDbDate:y}=Z(),t=q,C=p,_=()=>C("close"),h=()=>{C("success"),C("reloadTable"),_()},V=()=>{C("error")},d=()=>{C("noDataChange")},r=A({member:((H=t.membership)==null?void 0:H.member_id)??void 0,plan:((R=t.membership)==null?void 0:R.plan)??void 0,start_date:(M=t.membership)!=null&&M.start_date?y(t.membership.start_date):void 0}),i=A(ue.cloneDeep({member:((c=t.membership)==null?void 0:c.member_id)??void 0,plan:((D=t.membership)==null?void 0:D.plan)??void 0,start_date:(o=t.membership)!=null&&o.start_date?y(t.membership.start_date):void 0})),T=["member","plan","start_date"],S=te(()=>T.some(P=>{const m=r.value[P],B=i.value[P];return!be(m,B)})),O=async P=>{var m;if(!S.value){d();return}if(await u.updateMembership((m=t.membership)==null?void 0:m.id,P.data),v.value){V();return}h()};return(P,m)=>{const B=ee,N=re,F=X,L=ie,K=ne,de=oe,ce=Q;return I(),W(ce,{"on-close":_,title:"Update Membership"},{default:s(()=>[n(de,{schema:"UpdateMembershipValidationSchema"in P?P.UpdateMembershipValidationSchema:e(Ee),state:e(r),onSubmit:ae(O,["prevent"]),class:"space-y-6"},{default:s(()=>[n(N,{label:"Member (No Active Membership)",name:"member",error:e(x).member,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(B,{searchable:"","searchable-placeholder":"Search member...",modelValue:e(r).member,"onUpdate:modelValue":m[0]||(m[0]=$=>e(r).member=$),options:e(E),"value-attribute":"id","option-attribute":"full_name",placeholder:"Select"},{option:s(({option:$})=>[l("span",Ye,w($.full_name),1)]),_:1},8,["modelValue","options"])]),_:1},8,["error"]),n(N,{label:"Plan (Validity / Price)",name:"plan",error:e(x).plan,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(B,{searchable:"","searchable-placeholder":"Search plan...",modelValue:e(r).plan,"onUpdate:modelValue":m[1]||(m[1]=$=>e(r).plan=$),options:e(g),"option-attribute":"name",by:"name",placeholder:"Select"},{option:s(({option:$})=>[l("span",Pe,[k(w($.name)+" ",1),l("span",Ae,[m[3]||(m[3]=k("(")),l("span",Te,w($.validity>1?$.validity+" mos.":$.validity+" mo.")+" / ₱"+w($.price),1),k(") - "+w($.description),1)])])]),_:1},8,["modelValue","options"])]),_:1},8,["error"]),n(N,{label:"Start Date",name:"start_date",error:e(x).start_date,ui:{wrapper:"md:w-full"}},{default:s(()=>[n(K,{popper:{placement:"bottom-start"}},{panel:s(({close:$})=>[n(L,{modelValue:e(r).start_date,"onUpdate:modelValue":m[2]||(m[2]=me=>e(r).start_date=me),"is-required":"",mode:"date",onClose:$},null,8,["modelValue","onClose"])]),default:s(()=>[n(F,{icon:"i-heroicons-calendar-days-20-solid",label:e(r).start_date?e(Y)(e(r).start_date,"YYYY/MM/DD"):"Select Date",ui:{base:"w-full md:w-full"},variant:"outline",color:"gray"},null,8,["label"])]),_:1})]),_:1},8,["error"]),n(F,{type:"submit",loading:e(b),disabled:!e(S)},{default:s(()=>m[4]||(m[4]=[k(" Update ")])),_:1},8,["loading","disabled"])]),_:1},8,["schema","state"])]),_:1})}}}),ke={class:"grid grid-cols-2 gap-0 text-center"},Ne={class:"font-semibold"},je={class:"font-semibold"},Fe={class:"font-semibold"},He={class:"font-semibold"},Re={class:"font-semibold"},Oe=G({__name:"DeleteModal",props:{membership:Object},emits:["reloadTable","success","error","close"],setup(q,{emit:p}){const u=J(),{loading:b,hasError:x}=j(u),v=q,a=p,g=()=>a("close"),U=()=>{a("success"),a("reloadTable"),g()},E=()=>{a("error")},Y=async()=>{var y;if(await u.deleteMembership((y=v.membership)==null?void 0:y.id),x.value){E();return}U()};return(y,t)=>{const C=X,_=Q;return I(),W(_,{"on-close":g,title:"Delete Membership?",ui:{width:"md:max-w-1xl"}},{default:s(()=>{var h,V,d,r,i;return[t[6]||(t[6]=l("p",{class:"italic"},"This action cannot be undone.",-1)),t[7]||(t[7]=l("p",{class:"italic mb-2"}," All data associated with this membership will be deleted. ",-1)),l("div",ke,[t[0]||(t[0]=l("span",{class:"italic"},"Member:",-1)),l("span",Ne,w((h=v.membership)==null?void 0:h.member_name),1),t[1]||(t[1]=l("span",{class:"italic"},"Plan:",-1)),l("span",je,w((V=v.membership)==null?void 0:V.plan.name),1),t[2]||(t[2]=l("span",{class:"italic"},"Date Started: ",-1)),l("span",Fe,w((d=v.membership)==null?void 0:d.start_date),1),t[3]||(t[3]=l("span",{class:"italic"},"Date of Expiry: ",-1)),l("span",He,w((r=v.membership)==null?void 0:r.expiry_date),1),t[4]||(t[4]=l("span",{class:"italic"},"Status: ",-1)),l("span",Re,w((i=v.membership)==null?void 0:i.status_word),1)]),n(C,{variant:"solid",color:"red",class:"w-full justify-center mt-4",ui:{base:"text-center"},onClick:Y,loading:e(b)},{default:s(()=>t[5]||(t[5]=[k(" Delete this membership ")])),_:1},8,["loading"])]}),_:1})}}}),Xe=G({__name:"index",setup(q){ge({title:"Memberships"});const p=Se(),{actionToastResult:u}=_e(),b=J(),{memberships:x,loading:v,page:a,pageCount:g,search:U,sort:E,totalMemberships:Y,selectedStatus:y}=j(b),{columns:t,items:C,statusOptions:_}=Me;b.getMemberships();const h=()=>{p.open(qe,{onReloadTable(){b.getMemberships()},onSuccess(){u({icon:"i-heroicons-check-circle",description:"Membership created successfully.",id:"modal-success",color:"green"})},onError(){u({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onClose(){p.close()}})},V=r=>{p.open(Be,{membership:r,onReloadTable(){b.getMemberships()},onSuccess(){u({icon:"i-heroicons-check-circle",description:"Membership updated successfully.",id:"modal-success",color:"green"})},onError(){u({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onNoDataChange(){u({icon:"i-heroicons-exclamation-circle",description:"No data changes detected.",id:"modal-warning",color:"yellow"})},onClose(){p.close()}})},d=r=>{p.open(Oe,{membership:r,onReloadTable(){b.getMemberships()},onSuccess(){u({icon:"i-heroicons-check-circle",description:"Membership deleted.",id:"modal-success",color:"green"})},onError(){u({icon:"i-heroicons-x-circle",description:"Something went wrong.",id:"modal-error",color:"red"})},onClose(){p.close()}})};return z(U,()=>{a.value=1,b.getMemberships()}),z(g,()=>{a.value=1,b.getMemberships()}),z([a,g],()=>{b.getMemberships()}),z(y,()=>{a.value=1,b.getMemberships()}),(r,i)=>{const T=he;return I(),ve("div",null,[n(T,{"module-title":"Memberships",columns:e(t),"table-data":e(x),"is-expandable":!1,"action-items":e(C),"add-data-modal":h,loading:e(v),"action-handlers":{edit:V,delete:d},pagination:{page:e(a),pageCount:e(g),total:e(Y)},sorting:e(E),search:e(U),"enable-dropdown-filter":!0,"dropdown-filter-options":e(_),"onUpdate:page":i[0]||(i[0]=S=>a.value=S),"onUpdate:pageCount":i[1]||(i[1]=S=>g.value=S),"onUpdate:sort":e(b).getMemberships,"onUpdate:search":i[2]||(i[2]=S=>U.value=S),"onUpdate:selectedDropdownFilter":i[3]||(i[3]=S=>y.value=S)},null,8,["columns","table-data","action-items","loading","action-handlers","pagination","sorting","search","dropdown-filter-options","onUpdate:sort"])])}}});export{Xe as default};
